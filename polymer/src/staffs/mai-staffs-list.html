<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<!--<link rel="import" href="../../bower_components/vaadin-grid/all-imports.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">

<link rel="import" href="../mai-datatable-styles.html">-->


<dom-module id="mai-staffs-list">
    <template>
        <style include="mai-datatable-styles">

        </style>

        <app-localstorage-document key="token" data="{{tokenData}}" storage="window.localStorage"></app-localstorage-document>

        <iron-ajax
                auto
                id="getStaffsList"
                method="get"
                url="[[_computeURL()]]"
                headers$='{"FM-data-token": "[[tokenData.token]]"}'
                handle-as="json"
                last-response="{{listData}}"
                on-response="listLoaded"
        ></iron-ajax>

        <vaadin-grid items="{{listData}}" id="staffsListViewDatatable" class="list-view-datatable" active-item="{{selectedItem}}" >

            <vaadin-grid-column>
                <template class="header">
                    <vaadin-grid-sorter path="fieldData.ID_staff">STA ID</vaadin-grid-sorter>
                </template>
                <template>[[item.fieldData.ID_staff]]</template>
            </vaadin-grid-column>
            <vaadin-grid-column>
                <template class="header">
                    <vaadin-grid-sorter path="fieldData.Name_First">First name</vaadin-grid-sorter>
                </template>
                <template>[[item.fieldData.Name_First]]</template>
            </vaadin-grid-column>
            <vaadin-grid-column>
                <template class="header">Last Name</template>
                <template>[[item.fieldData.Name_Last]]</template>
            </vaadin-grid-column>
            <vaadin-grid-column>
                <template class="header">State</template>
                <template>[[item.fieldData.State_Province]]</template>
            </vaadin-grid-column>
            <vaadin-grid-column>
                <template class="header">Phone</template>
                <template>[[item.fieldData.Phone1]]</template>
            </vaadin-grid-column>
            <vaadin-grid-column>
                <template class="header">Email</template>
                <template>[[item.fieldData.Email]]</template>
            </vaadin-grid-column>
            <vaadin-grid-column>
                <template class="header">Permissions</template>
                <template>[[item.fieldData.Permissions]]</template>
            </vaadin-grid-column>
            <vaadin-grid-column>
                <template class="header">Status</template>
                <template>[[item.fieldData.Status]]</template>
            </vaadin-grid-column>
        </vaadin-grid>

    </template>
    <script>

        class MaiStaffsList extends Polymer.Element
        {
            static get is() { return 'mai-staffs-list'; }
            static get properties() {
                return {
                    listData: {
                        type: Array,
                        notify:true
                    },
                    selectedItem: {
                        observer: '_selectedItemChanged'
                    }
                }
            }

            listLoaded(data){
                this.listData= data.detail.response;
                if(this.listData) {
                    this.$.staffsListViewDatatable.activeItem = this.listData[0];
                }
                //console.log(this.listData);
            }

            _selectedItemChanged(item){
                if(item) {
                    this.$.staffsListViewDatatable.selectedItems = item ? [item] : [];

                    this.dispatchEvent(new CustomEvent('staff-item-selected',
                        {
                            bubbles: true,
                            composed: true,
                            detail: {
                                data: this.selectedItem
                            }
                        }));
                }
            }

            _computeURL(){
                return `https://localhost:3000/fm/getList/L130_STAFF_Data_Entry`;
                //return `https://localhost:3000/fm/getLocalStaffsList`;
            }
        }

        window.customElements.define(MaiStaffsList.is, MaiStaffsList);

    </script>
</dom-module>