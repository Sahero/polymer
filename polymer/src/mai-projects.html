<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="styles/mai-shared-styles.html">

<link rel="import" href="../bower_components/app-route/app-route.html">
<link rel="import" href="../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../bower_components/iron-selector/iron-selector.html">

<link rel="import" href="../bower_components/paper-tabs/paper-tabs.html">

<dom-module id="mai-projects">
    <template>

        <custom-style>
            <style is="custom-style" include="mai-shared-styles">

            </style>
        </custom-style>

        <app-route
                route="[[route]]"
                pattern="/:page"
                data="{{projectsData}}"
        ></app-route>


        <app-toolbar>
            <iron-selector class="view-toolbar" selected="[[projectsData.page]]"  attr-for-selected="name" role="navigation">

                <a name="projects-detail" href="[[route.prefix]]/projects-detail">
                    <paper-fab mini icon="content-copy"></paper-fab>
                    Detail view</a>
                <a name="projects-list" href="[[route.prefix]]/projects-list">
                    <paper-fab mini icon="list"></paper-fab>
                    List view</a>
            </iron-selector>
        </app-toolbar>
        <div>
            <iron-pages selected="[[projectsData.page]]" attr-for-selected="name">

                <mai-projects-list name="projects-list" ></mai-projects-list>
                <mai-projects-detail id="detailView" name="projects-detail" recordId="{{recordId}}"></mai-projects-detail>

            </iron-pages>
        </div>

    </template>

    <script>
        (function() {
            class MaiProjects extends Polymer.Element {
                static get is() {
                    return 'mai-projects';
                }

                static get properties(){
                    return {
                        projectsData: {
                            type:Object,
                            notify:true,
                            observer:'_onProjectsDataChanged'},
                        recordId: {
                            type:String,
                            notify:true,
                        },
                        visible: {
                            type: Boolean,
                            //observer: '_visibleChanged'
                        }
                    };
                }
                /*constructor(){
                 super();

                 console.log(this.projectsData);
                 }
                 */
                _onProjectsDataChanged(projectsData,oldProjectsData){

                    if(projectsData.page === undefined || projectsData.page ===""){
                        this.projectsData.page = projectsData.page || "projects-list";
                        this.set('route.path',this.projectsData.page);
                    }
                    else{
                        if(this.visible) {
                            this.dispatchEvent(new CustomEvent('change-view',
                                {
                                    bubbles: true,
                                    composed: true,
                                    detail: {
                                        name: 'projects',
                                        view: projectsData.page
                                    }
                                }));
                        }
                    }


                }

                ready(){
                    super.ready();
                    this.addEventListener('project-item-selected', e => this._onProjectItemSelected(e));
                }

                _onProjectItemSelected(event){
                    let detail = event.detail;
                    this.recordId = detail.recordId;
                    //console.log(this.recordId);
                    this.$.detailView.recordId = this.recordId;
                }



            }

            window.customElements.define(MaiProjects.is, MaiProjects);
        }());
    </script>
</dom-module>
