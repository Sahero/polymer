<link rel="import" href="../bower_components/polymer/polymer-element.html">

<dom-module id="mai-get-list-data">

    <template>
        <app-localstorage-document key="token" data="{{tokenData}}" storage="window.localStorage"></app-localstorage-document>

        <iron-ajax
                id="getList"
                method="get"
                url="[[_computeURL()]]"
                headers$='{"FM-data-token": "[[tokenData.token]]"}'
                handle-as="json"
                on-response="listLoaded"
        ></iron-ajax>
    </template>

    <script>
        (function() {
            class MaiGetListData extends Polymer.Element {
                static get is() {
                    return 'mai-get-list-data';
                }

                static get properties() {
                    return {
                        listData: {
                            type: Array,
                            notify: true,
                        },
                        layoutName:{
                            type: String
                        },
                        selectedItem: {
                            type: Object,
                            notify: true
                        },
                    }
                }
                ready(){
                    super.ready();
                    this.$.getList.generateRequest();
                }

                listLoaded(data) {
                    if(data.detail.response!==null) {
                        this.listData = data.detail.response;
                        console.log(this.listData);
                        this.selectedItem = this.listData[0];
                    }
                }

                _computeURL() {
                    return `https://localhost:3000/fm/getList/${this.layoutName}`;
                }

            }
            window.customElements.define(MaiGetListData.is, MaiGetListData);
        }());
    </script>
</dom-module>