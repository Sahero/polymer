<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="shared-styles.html">
<link rel="import" href="../bower_components/iron-localstorage/iron-localstorage.html">
<link rel="import" href="../bower_components/app-route/app-location.html">
<link rel="import" href="../bower_components/vaadin-grid/all-imports.html">

<link rel="import" href="user-data.html">
<link rel="import" href="log-out.html">

<dom-module id="my-view2">
  <template>
    <custom-style>
      <style is="custom-style">
        vaadin-grid#transparent-header {
          font: 500 13px "Open Sans", sans-serif;
          color: rgb(148, 154, 171);
          --divider-color: rgb(223, 232, 239);

          --vaadin-grid-cell: {
            padding: 0 13px;
          };

          --vaadin-grid-body-cell: {
            height: 65px;
          };

          --vaadin-grid-header-cell: {
            background: rgba(235, 238, 246, 0.9);
            border-bottom: 1px solid rgba(208, 217, 225, 0.9);
            border-top: 1px solid rgba(248, 250, 252, 0.9);
            min-height: 35px;

            background-image: linear-gradient(rgba(108, 160, 218, 0), rgba(108, 160, 218, 0.15));
            background-size: 1px 100%;
            background-position: 100% 0%;
            background-repeat: no-repeat;
          };

          --vaadin-grid-body-row-selected-cell: {
            background-color: rgb(131, 183, 236);
            color: #fff;
            border-bottom-color: rgb(108, 160, 218);
          };

          --vaadin-grid-body-row-odd-cell: {
            background-color: rgb(251, 252, 254);
          };

          --vaadin-grid-body-row-hover-cell: {
            background-color: rgb(235, 238, 246);
          };

          --vaadin-grid-body-row-details-cell: {
            text-align: center;
          };

          --vaadin-grid-column-resize-handle: {
            opacity: 0;
          };
        }

        vaadin-grid#transparent-header input[type=checkbox] {
          height: 16px;
          width: 16px;
        }

        vaadin-grid#transparent-header .image {
          height: 40px;
          width: 40px;
          display: inline-block;
          border-radius: 50%;
          vertical-align: middle;
          margin-right: 15px;
        }

        vaadin-grid#transparent-header .header-content {
          display: flex;
          padding: 16px;
          justify-content: space-between;
        }

        vaadin-grid#transparent-header .details-cell {
          background: #fff;
          width: 100%;
        }
      </style>
    </custom-style>
    <app-location route="{{route}}" data="{{routeData}}"></app-location>

    <iron-localstorage name="user-storage" value="{{storedUser}}"
                       on-iron-localstorage-load="getSeriesData"
    ></iron-localstorage>

    <user-data user="{{storedUser}}"></user-data>

    <iron-ajax
            id="getSeriesDataAjax"
            method="get"
            url="http://localhost:3000/bettercallsaul/data/random-episode"
            handle-as="json"
            last-response="{{seriesData}}"

    ></iron-ajax>
    <!--on-response="dataLoaded"-->
    <!--<template is="dom-if" if="{{storedUser.loggedin}}">-->

    <!--</template>-->

    <div class="card">
      <log-out stored-user="{{storedUser}}"></log-out>

      <vaadin-grid items="[[seriesData]]" id="transparent-header">
        <vaadin-grid-column>
          <template class="header">Name</template>
          <template>[[item.name]]</template>
        </vaadin-grid-column>
        <vaadin-grid-column>
          <template class="header">Episode</template>
          <template>[[item.number]]</template>
        </vaadin-grid-column>
        <vaadin-grid-column>
          <template class="header">URL</template>
          <template><a href="[[item.url]]" target="_blank">View</a></template>
        </vaadin-grid-column>
        <vaadin-grid-column>
          <template class="header">Image</template>
          <template>
            <div>
              <img alt="test" src="[[item.image.medium]]"/>
            </div>
          </template>
        </vaadin-grid-column>
      </vaadin-grid>
    </div>
  </template>

  <script>
      (function() {
          class MyView1 extends Polymer.Element {
              static get is() {
                  return 'my-view2';
              }

              static get properties() {
                  return {
                      storedUser: Object,
                  };
              }

              getSeriesData() {
                  if (this.storedUser.loggedin) {
                      this.$.getSeriesDataAjax.headers['Authorization'] = 'Bearer ' + this.storedUser.access_token;
                      this.$.getSeriesDataAjax.generateRequest();
                      //console.log(this.$.getSeriesDataAjax.lastResponse);
                      //console.log(this.$.getSeriesDataAjax.lastRequest.response);
                      //console.log(this.$.getSeriesDataAjax);
                      //this.seriesData = JSON.parse(this.seriesData);
                  }
                  else{
                      this.set('route.path','/my-login');
                  }
              }
          /*dataLoaded(data){
           console.log(data);
           console.log(data.detail.response[0]);
           this.seriesDatas = data.detail.response[0];
           }*/

          }

          window.customElements.define(MyView1.is, MyView1);
      }());
  </script>
</dom-module>
